<?php 

/*

Template Name: Handcraft Expo Contact Template

*/ ?>

    <?php
     
      $handcraft_expo_response = "";
     
      function generate_response($handcraft_expo_type, $handcraft_expo_message){
       
        global $handcraft_expo_response;
     
        if($handcraft_expo_type == "success") $handcraft_expo_response = "<div class='success'>{$message}</div>";
        else $handcraft_expo_response = "<div class='error'>{$message}</div>";
       
      }
     
      //response messages
      $handcraft_expo_not_human       = "Human verification incorrect.";
      $handcraft_expo_missing_content = "Please fill the required fields.";
      $handcraft_expo_email_invalid   = "Invalid e-mail address.";
      $handcraft_expo_message_unsent  = "Message was not sent. Please try again.";
      $handcraft_expo_message_sent    = "Thank You! Your message has been sent.";
     
      //user posted
      $handcraft_expo_name = $_POST['message_name'];
      $handcraft_expo_email = $_POST['message_email'];
      $handcraft_expo_message = $_POST['message_text'];
      $handcraft_expo_human = $_POST['message_human'];
     
      //php mailer
      $handcraft_expo_to = get_option('admin_email');
      $handcraft_expo_subject = "Someone sent you a message from ".get_bloginfo('name');
      $handcraft_expo_headers = 'From: '. $handcraft_expo_name . "\r\n" .
        'Reply-To: ' . $handcraft_expo_email . "\r\n";
     
      if(!$handcraft_expo_human == 0){
        if($handcraft_expo_human != 7) generate_response("error", $handcraft_expo_not_human); //not human!
        else {
         
          //validate email
          if(!filter_var($handcraft_expo_email, FILTER_VALIDATE_EMAIL))
            generate_response("error", $handcraft_expo_email_invalid);
          else //email is valid
          {
            //validate presence of name and message
            if(empty($handcraft_expo_name) || empty($handcraft_expo_message)){
              generate_response("error", $handcraft_expo_missing_content);
            }
            else //ready
            {
              $handcraft_expo_sent = mail($handcraft_expo_to, $handcraft_expo_subject, $handcraft_expo_message, $handcraft_expo_headers);
              if($handcraft_expo_sent) generate_response("success", $handcraft_expo_message_sent); //message sent
              else generate_response("error", $handcraft_expo_message_unsent); //message not sent
            }
          }
        }
      }
      else if ($_POST['submitted']) generate_response("error", $handcraft_expo_missing_content);

	get_header();
	
	get_sidebar(); ?>

					<style type="text/css">

						.mobile-page-content .pages-navigation,
						.mobile-page-content .ancestors-children-nav {				
								visibility: hidden;				
							}

					</style>

<?php

	if (! is_active_sidebar('widgets_sidebar')) { ?>
	
					<style type="text/css">
	
								.contact-form-container {
								
										min-width: 96%;
										max-width: 96%;
								
									}

								.widgets-bar-bottom-div {
									
										min-width: 96%;
										max-width: 96%;
										margin-left: -1%;
									
									}

					</style>

<?php }
	
	else { ?>

					<style type="text/css">
	
								.contact-form-container {
								
										min-width: 63%;
										max-width: 63%;
								
									}

					</style>
			
<?php };
	
	$handcraft_expo_pageTitlePosCheck = get_theme_mod('handcraft-expo_page_title_position');
	
	if ($handcraft_expo_pageTitlePosCheck == 'as_banner') { ?>

								<div class="page-title">
									<h1><?php the_title();?></h1>
								</div>
		
<?php	}; 

	if (is_active_sidebar('widgets_sidebar')) { ?>
			
								<div class="sidebar-button clearfix">

									<div class="sidebar-control">
									
										<img src="<?php echo get_template_directory_uri(); ?>/img/icons/sidebar-control.png" alt="" />
									
									</div>
								
								</div>
		
<?php } ?>

								<div class="contact-form-container">

<?php

	if ($handcraft_expo_pageTitlePosCheck == 'as_content') { ?>

									<h1 class="page-title-inside"><?php the_title();?></h1>
		
<?php	}; ?>

							      <div id="primary" class="site-content">
							        
							        <div id="content" role="main">
							     
<?php 
	if ( have_posts() ) :						          
		while ( have_posts() ) : the_post(); ?>
							     
							              <article id="post-<?php the_ID(); ?>" <?php post_class(); ?>>
							     
							                <div class="entry-content">
							                	<p><?php the_content(); ?></p>
							     
							                  <div id="respond">
							                    <?php echo $handcraft_expo_response; ?>
							                    <form action="<?php the_permalink(); ?>" method="post">
							                      <p><label for="name">Name: <span>*</span> <br><input type="text" name="message_name" value="<?php echo $_POST['message_name']; ?>"></label></p>
							                      <p><label for="message_email">Your e-mail: <span>*</span> <br><input type="text" name="message_email" value="<?php echo $_POST['message_email']; ?>"></label></p>
							                      <p><label for="message_text">Message: <span>*</span> <br><textarea type="text" name="message_text"><?php echo $_POST['message_text']; ?></textarea></label></p>
							                      <p><label for="message_human">Verification: <span>*</span> <br><input type="text" style="width: 60px;" name="message_human"> + 3 = 10</label></p>
							                      <input type="hidden" name="submitted" value="1">
							                      <p><input id="formsubmit" type="submit"></p>
							                    </form>
							                  </div>
							     
							     
							                </div><!-- .entry-content -->
							     
							              </article><!-- #post -->
							     
							        </div><!-- #content -->
							      </div><!-- #primary -->								

<?php

	$handcraft_expo_contentFooterCheck = get_theme_mod('handcraft-expo_content_footer_image');

	if ($handcraft_expo_contentFooterCheck != '') { ?>

									<div class="content-footer">
										<img id="content-footer-image" src="<?php echo esc_url(get_theme_mod('handcraft-expo_content_footer_image')); ?>"  alt="" />
									</div>

<?php }; ?>
															
								</div>

<?php 
	
	endwhile;
	
		else : ?>
					<div class="page-main-content">
						<h2 class="not-found"><?php echo __('Ooops! No content found!', 'handcraft-expo'); ?></h2>
						<h3 class="not-found-2"><?php echo __('You might want to go back to the', 'handcraft-expo'); ?> <a href="<?php echo home_url(); ?>"><?php echo __('homepage', 'handcraft-expo'); ?></a>.</h3>
					</div>
	
<?php	endif;

	get_template_part('bottom-widgets');
	
	get_footer();
	
?>